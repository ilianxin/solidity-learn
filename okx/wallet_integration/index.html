<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>okx wallet integration</title>
</head>

<body>
    <div>
        <label class="okxwallet"></label>
    </div>
    <div>
        <button class="connectEthereumButton">Connect to Ethereum</button>
        <label class="account"></label>
    </div>
    <div>
        ChainId: <label class="chainId"></label>
    </div>
</body>
<script>
    if (typeof window.okxwallet !== 'undefined') {
        console.log('OKX is installed!');
        document.querySelector('.okxwallet').textContent = 'OKX is installed!';
    }

    const connectEthereumButton = document.querySelector('.connectEthereumButton');

    let accounts = [];

    // step1 创建连接
    connectEthereumButton.addEventListener('click', async () => {
        //Will Start the OKX extension
        accounts = await okxwallet.request({ method: 'eth_requestAccounts' });
        console.log("accounts: ", accounts);
        document.querySelector('.account').textContent = accounts[0];
    });

    // okxwallet.on('accountsChanged', handler: (accounts: Array<string>) => void);

    // step2 监听地址变化#
    okxwallet.on('accountsChanged', (accounts) => {
        // Handle accounts changed event
        console.log('Accounts changed:', accounts);
        document.querySelector('.account').textContent = accounts[0];
    });

    // step3 监听网络变化#
    window.addEventListener('load', async () => {
        const chainId = await window.ethereum.request({ method: 'eth_chainId' });
        console.log("chainId: ", chainId);
        document.querySelector('.chainId').textContent = chainId;
        // window.ethereum.on('chainChanged', handleChainChanged);
        okxwallet.on('chainChanged', handleChainChanged);
    });
    function handleChainChanged(chainId) {
        // We recommend reloading the page, unless you must do otherwise.
        console.log("new chainId: ", chainId);
        // window.location.reload();
        document.querySelector('.chainId').textContent = chainId;
    }
</script>

</html>